<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Oficios (WORD) - Ministerio P√∫blico</title>
    
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f3f4f6; padding: 20px; color: #1f2937; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #1e3a8a; margin-bottom: 5px; }
        
        .section-title { 
            background-color: #e0f2fe; border-left: 5px solid #1e3a8a; padding: 10px 15px; 
            font-weight: bold; margin-top: 30px; margin-bottom: 15px; color: #1e40af; 
            cursor: pointer; display: flex; justify-content: space-between; align-items: center;
        }
        .section-content { display: block; padding: 10px; border: 1px solid #e5e7eb; border-top: none; border-radius: 0 0 5px 5px; margin-bottom: 20px; }
        .hidden { display: none; }
        .form-row { display: flex; gap: 20px; margin-bottom: 15px; }
        .form-col { flex: 1; }
        label { display: block; font-weight: 600; margin-bottom: 5px; color: #374151; font-size: 13px; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; box-sizing: border-box; }
        textarea { height: 70px; resize: vertical; }
        .pericia-box { border: 1px dashed #2563eb; padding: 15px; margin-bottom: 15px; background: #eff6ff; border-radius: 5px; }
        button { width: 100%; padding: 16px; background-color: #1e3a8a; color: white; border: none; border-radius: 6px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 40px; transition: background 0.2s; }
        button:hover { background-color: #1e40af; }
        
        /* Estado del Logo discreto */
        .status-bar { font-size: 11px; text-align: right; color: #6b7280; margin-bottom: 10px; }
        .text-ok { color: #15803d; font-weight: bold; }
        .text-err { color: #b91c1c; }
    </style>
</head>
<body>

<div class="container">
    <h1>Generador de Oficios (WORD)</h1>
    <div class="status-bar">
        Estado del Logo: <span id="estadoImagen">Buscando logo.png...</span>
    </div>

    <div class="section-title" onclick="toggleSection('sec1')">1. Datos Generales ‚ñº</div>
    <div id="sec1" class="section-content">
        <div class="form-row">
            <div class="form-col"><label>N¬∞ Oficio / Carpeta (C√≥digo √∫nico):</label><input type="text" id="codigoUnico" placeholder="Ej: 244-2023"></div>
            <div class="form-col"><label>A√±o:</label><input type="text" id="anio" value="2025"></div>
        </div>
        <div class="form-row">
            <div class="form-col"><label>D√≠a (Oficio):</label><select id="dia"></select></div>
            <div class="form-col">
                <label>Mes (Oficio):</label>
                <select id="mes">
                    <option value="enero">Enero</option><option value="febrero">Febrero</option><option value="marzo">Marzo</option>
                    <option value="abril">Abril</option><option value="mayo">Mayo</option><option value="junio">Junio</option>
                    <option value="julio">Julio</option><option value="agosto">Agosto</option><option value="septiembre">Septiembre</option>
                    <option value="octubre">Octubre</option><option value="noviembre">Noviembre</option><option value="diciembre">Diciembre</option>
                </select>
            </div>
        </div>
    </div>

    <div class="section-title" onclick="toggleSection('sec2')">2. Cuerpo Principal ‚ñº</div>
    <div id="sec2" class="section-content">
        <div class="form-row">
            <div class="form-col">
                <label>N¬∞ Disposici√≥n:</label>
                <select id="numDisposicion"></select>
            </div>
            <div class="form-col">
                <label>Fecha Disposici√≥n:</label>
                <input type="date" id="fechaDisposicion">
            </div>
        </div>

        <div class="form-row">
            <div class="form-col">
                <label>Decisi√≥n:</label>
                <select id="decision">
                    <option value="La AMPLIACI√ìN SUPLEMENTARIA DE LA INVESTIGACI√ìN PREPARATORIA">La AMPLIACI√ìN SUPLEMENTARIA DE LA INVESTIGACI√ìN PREPARATORIA</option>
                    <option value="INICIO DE DILIGENCIAS PRELIMINARES">INICIO DE DILIGENCIAS PRELIMINARES</option>
                     <option value="FORMALIZACI√ìN DE LA INVESTIGACI√ìN PREPARATORIA">FORMALIZACI√ìN DE LA INVESTIGACI√ìN PREPARATORIA</option>
                </select>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-col"><label>Imputados:</label><input type="text" id="imputados" placeholder="Nombres..."></div>
        </div>

        <div class="form-row" style="background: #f9fafb; padding: 10px; border-radius: 5px;">
            <div class="form-col" style="flex: 0 0 30%;">
                <label>Cantidad de Delitos:</label>
                <select id="cantDelitos" onchange="generarCamposDelitos()">
                    <option value="1">1 Delito</option>
                    <option value="2">2 Delitos</option>
                    <option value="3">3 Delitos</option>
                    <option value="4">4 Delitos</option>
                    <option value="5">5 Delitos</option>
                </select>
            </div>
            <div class="form-col">
                <label>Selecci√≥n de Delitos:</label>
                <div id="contenedorDelitos"></div>
            </div>
        </div>

        <div class="form-row">
            <div class="form-col">
                <label>Plazo Actuaciones:</label>
                <select id="plazoActuaciones">
                    <option value="treinta (30) d√≠as naturales">treinta (30) d√≠as naturales</option>
                    <option value="sesenta (60) d√≠as naturales">sesenta (60) d√≠as naturales</option>
                    <option value="noventa (90) d√≠as naturales">noventa (90) d√≠as naturales</option>
                    <option value="ciento veinte (120) d√≠as naturales">ciento veinte (120) d√≠as naturales</option>
                    <option value="ciento cincuenta (150) d√≠as naturales">ciento cincuenta (150) d√≠as naturales</option>
                    <option value="ciento ochenta (180) d√≠as naturales">ciento ochenta (180) d√≠as naturales</option>
                </select>
            </div>
        </div>
    </div>

    <div class="section-title" onclick="toggleSection('sec3')">3. Datos T√©cnicos ‚ñº</div>
    <div id="sec3" class="section-content">
        <div class="form-row">
            <div class="form-col">
                <label>Etapa Procesal:</label>
                <select id="etapaProcesal">
                    <option value="Investigaci√≥n Preparatoria">Investigaci√≥n Preparatoria</option>
                    <option value="Diligencias Preliminares">Diligencias Preliminares</option>
                </select>
            </div>
            <div class="form-col"><label>Plazo Vencimiento:</label><input type="date" id="plazoVencimiento"></div>
        </div>
        <div class="form-row">
            <div class="form-col"><label>Cantidad Involucrados:</label><select id="cantInvolucrados"></select></div>
            <div class="form-col"><label>Disposici√≥n que ordena (C√≥digo):</label><input type="text" id="dispoOrdena" placeholder="Ej: 01-2025-MP-FN..."></div>
        </div>
    </div>

    <div class="section-title" onclick="toggleSection('sec4')">4. Objetos de Pericia ‚ñº</div>
    <div id="sec4" class="section-content">
        <label>¬øCu√°ntos objetos periciales necesitas?</label>
        <select id="cantPericias" onchange="generarCamposPericias()" style="margin-bottom: 20px;">
            <option value="0">-- Seleccionar --</option>
            <option value="1">1 Objeto</option>
            <option value="2">2 Objetos</option>
            <option value="3">3 Objetos</option>
            <option value="4">4 Objetos</option>
            <option value="5">5 Objetos</option>
            <option value="6">6 Objetos</option>
            <option value="7">7 Objetos</option>
            <option value="8">8 Objetos</option>
            <option value="9">9 Objetos</option>
            <option value="10">10 Objetos</option>
        </select>
        <div id="contenedorPericias"></div>
    </div>

    <div class="section-title" onclick="toggleSection('sec5')">5. Evidencia Adjunta ‚ñº</div>
    <div id="sec5" class="section-content">
        <label>¬øAgregar secci√≥n de evidencia?</label>
        <select id="tieneEvidencia" onchange="toggleEvidencia()">
            <option value="no">No hay evidencia</option>
            <option value="si">S√≠, agregar evidencia</option>
        </select>
        <div id="boxEvidencia" class="hidden" style="margin-top: 15px;">
            <label>Descripci√≥n de evidencia:</label><textarea id="descEvidencia" placeholder="Se precisa que la totalidad de los actuados..."></textarea>
            <label style="margin-top:10px;">Enlace (Link):</label><input type="text" id="linkEvidencia" placeholder="https://drive.google.com/...">
        </div>
    </div>

    <div class="section-title" onclick="toggleSection('sec6')">6. Contacto ‚ñº</div>
    <div id="sec6" class="section-content">
        <div class="form-row">
            <div class="form-col"><label>Email Mesa:</label><input type="text" id="emailMesa" value="fecoflima_1f2d@mpfn.gob.pe"></div>
            <div class="form-col"><label>Email Fiscal:</label><input type="text" id="emailFiscal" value="ncordova@mpfn.gob.pe"></div>
        </div>
        <div class="form-row">
            <div class="form-col"><label>Tel. Fiscal:</label><input type="text" id="telFiscal" value="945 112 224"></div>
            <div class="form-col"><label>Tel. Asistente:</label><input type="text" id="telAsistente" value="957 691 331"></div>
        </div>
    </div>

    <button onclick="generarWord()">üìÑ DESCARGAR WORD EDITABLE</button>
</div>

<script>
    const NOMBRE_ARCHIVO_IMAGEN = "logo.png"; 
    let logoArrayBuffer = null;

    const listaOpcionesDelito = [
        "Colusi√≥n Simple", "Colusi√≥n Agravada", "Negociaci√≥n Incompatible", 
        "Peculado", "Peculado Doloso", "Peculado Culposo", 
        "Tr√°fico de Influencias", "Concusi√≥n", "Cohecho", 
        "Cohecho Pasivo", "Cohecho Activo", "Cohecho Pasivo Propio", 
        "Cohecho Pasivo Impropio", "Usurpaci√≥n de Funciones"
    ];

    function cargarLogoAutomatico() {
        const xhr = new XMLHttpRequest();
        xhr.open('GET', NOMBRE_ARCHIVO_IMAGEN, true);
        xhr.responseType = 'arraybuffer';
        xhr.onload = function() {
            if (xhr.status === 200) {
                logoArrayBuffer = xhr.response;
                document.getElementById('estadoImagen').innerText = "‚úÖ Logo cargado (logo.png)";
                document.getElementById('estadoImagen').className = "text-ok";
            }
        };
        xhr.onerror = function() { 
            // Silencioso, solo muestra en la barra
            document.getElementById('estadoImagen').innerText = "‚ö†Ô∏è No se detect√≥ logo.png (Subir a GitHub)"; 
        };
        xhr.send();
    }

    function formatearFechaLarga(fechaStr) {
        if (!fechaStr) return "_______";
        const partes = fechaStr.split("-");
        const meses = ["enero", "febrero", "marzo", "abril", "mayo", "junio", "julio", "agosto", "septiembre", "octubre", "noviembre", "diciembre"];
        const anio = partes[0];
        const mesIndex = parseInt(partes[1]) - 1;
        const dia = parseInt(partes[2]);
        return `${dia} de ${meses[mesIndex]} de ${anio}`;
    }

    window.onload = function() {
        cargarLogoAutomatico();
        generarCamposDelitos(); 

        const selectDia = document.getElementById('dia');
        for (let i = 1; i <= 31; i++) {
            let opt = document.createElement('option');
            opt.value = i; opt.innerHTML = i;
            selectDia.appendChild(opt);
        }
        const selectDispo = document.getElementById('numDisposicion');
        for (let i = 1; i <= 100; i++) {
            let val = i.toString().padStart(2, '0');
            let opt = document.createElement('option');
            opt.value = val; opt.innerHTML = val;
            selectDispo.appendChild(opt);
        }
        const selectInv = document.getElementById('cantInvolucrados');
        for (let i = 1; i <= 50; i++) {
            let opt = document.createElement('option');
            opt.value = i; opt.innerHTML = i;
            selectInv.appendChild(opt);
        }
    };

    function toggleSection(id) { document.getElementById(id).classList.toggle('hidden'); }
    function toggleEvidencia() {
        const val = document.getElementById('tieneEvidencia').value;
        document.getElementById('boxEvidencia').classList.toggle('hidden', val !== 'si');
    }

    function generarCamposDelitos() {
        const cant = document.getElementById('cantDelitos').value;
        const div = document.getElementById('contenedorDelitos');
        div.innerHTML = "";
        
        for(let i=0; i<cant; i++) {
            let select = document.createElement('select');
            select.id = `delitoSeleccionado_${i}`;
            select.style.width = "100%";
            select.style.marginBottom = "5px";
            select.style.padding = "8px";
            select.style.borderRadius = "4px";
            select.style.border = "1px solid #d1d5db";

            listaOpcionesDelito.forEach(opcion => {
                let opt = document.createElement('option');
                opt.value = opcion;
                opt.text = opcion;
                select.appendChild(opt);
            });
            div.appendChild(select);
        }
    }

    function generarCamposPericias() {
        const cant = document.getElementById('cantPericias').value;
        const div = document.getElementById('contenedorPericias');
        div.innerHTML = "";
        const tipos = ["Perito Contable", "Perito Econ√≥mico", "Perito Forense", "Perito Grafot√©cnico", "Otro"];
        for(let i=1; i<=cant; i++) {
            let html = `
            <div class="pericia-box">
                <label style="color:#1e40af;">OBJETO ${i}: Tipo de Pericia</label>
                <select id="tipoPericia_${i}" style="margin-bottom:10px;">${tipos.map(t => `<option value="${t}">${t}</option>`).join('')}</select>
                <label>Objeto Pericial:</label><textarea id="objPericia_${i}" placeholder="Practicar pericia..."></textarea>
                <label style="margin-top:5px;">Detalle:</label><textarea id="detPericia_${i}" placeholder="Detalles..."></textarea>
            </div>`;
            div.insertAdjacentHTML('beforeend', html);
        }
    }

    function generarWord() {
        const { Document, Packer, Paragraph, TextRun, Table, TableRow, TableCell, WidthType, ImageRun, AlignmentType, UnderlineType, BorderStyle, ShadingType, Footer, HeightRule } = docx;

        const codigo = document.getElementById('codigoUnico').value;
        const anio = document.getElementById('anio').value;
        const dia = document.getElementById('dia').value;
        const mes = document.getElementById('mes').value;
        const fechaTexto = `${dia} de ${mes} del ${anio}`;
        
        const numDispo = document.getElementById('numDisposicion').value;
        const fechaDispoRaw = document.getElementById('fechaDisposicion').value;
        const fechaDispoTexto = formatearFechaLarga(fechaDispoRaw);

        const decision = document.getElementById('decision').value;
        const imputados = document.getElementById('imputados').value;
        
        // --- DELITOS ---
        const cantDelitos = document.getElementById('cantDelitos').value;
        let listaDelitosArr = [];
        for(let i=0; i<cantDelitos; i++) {
            listaDelitosArr.push(document.getElementById(`delitoSeleccionado_${i}`).value);
        }
        let delitoTexto = "";
        if (listaDelitosArr.length === 1) {
            delitoTexto = listaDelitosArr[0];
        } else {
            const ultimo = listaDelitosArr.pop();
            delitoTexto = listaDelitosArr.join(", ") + " y " + ultimo;
        }

        const plazo = document.getElementById('plazoActuaciones').value;
        const etapa = document.getElementById('etapaProcesal').value;
        const vencimientoRaw = document.getElementById('plazoVencimiento').value;
        const vencimientoTexto = formatearFechaLarga(vencimientoRaw);
        const involucrados = document.getElementById('cantInvolucrados').value;
        const dispoOrdena = document.getElementById('dispoOrdena').value;

        const emailMesa = document.getElementById('emailMesa').value;
        const emailFiscal = document.getElementById('emailFiscal').value;
        const telFiscal = document.getElementById('telFiscal').value;
        const telAsistente = document.getElementById('telAsistente').value;

        const children = [];

        // ENCABEZADO
        let logoContent = [];
        if (logoArrayBuffer) {
            logoContent.push(new Paragraph({ children: [ new ImageRun({ data: logoArrayBuffer, transformation: { width: 50, height: 50 } }) ], alignment: AlignmentType.CENTER }));
        } else {
            logoContent.push(new Paragraph({ text: "", alignment: AlignmentType.CENTER }));
        }
        logoContent.push(new Paragraph({ children: [ new TextRun({ text: "MINISTERIO P√öBLICO", bold: false, size: 14, font: "Arial Narrow" }) ], alignment: AlignmentType.CENTER }));
        logoContent.push(new Paragraph({ children: [ new TextRun({ text: "PRIMERA FISCAL√çA PROVINCIAL CORPORATIVA\nESPECIALIZADA EN DELITOS DE CORRUPCI√ìN DE\nFUNCIONARIOS -SEGUNDO DESPACHO-", bold: false, size: 14, font: "Arial Narrow" }) ], alignment: AlignmentType.CENTER }));

        const headerTable = new Table({
            width: { size: 100, type: WidthType.PERCENTAGE },
            borders: { top: {style: BorderStyle.NONE}, bottom: {style: BorderStyle.NONE}, left: {style: BorderStyle.NONE}, right: {style: BorderStyle.NONE}, insideVertical: {style: BorderStyle.NONE}, insideHorizontal: {style: BorderStyle.NONE} },
            rows: [
                new TableRow({
                    children: [
                        new TableCell({ width: { size: 40, type: WidthType.PERCENTAGE }, children: logoContent, margins: { left: -1000 } }), 
                        new TableCell({ width: { size: 60, type: WidthType.PERCENTAGE }, children: [
                            new Paragraph({ children: [ new TextRun({ text: "‚ÄúA√±o de la recuperaci√≥n y consolidaci√≥n de la econom√≠a peruana‚Äù", italics: true, size: 18, font: "Arial Narrow" }) ], alignment: AlignmentType.RIGHT }),
                            new Paragraph({ text: "" }),
                            new Paragraph({ children: [ new TextRun({ text: `Lima, ${fechaTexto}`, size: 24, font: "Arial Narrow" }) ], alignment: AlignmentType.RIGHT })
                        ]})
                    ]
                })
            ]
        });
        children.push(headerTable);
        children.push(new Paragraph({ text: "" }));

        // OFICIO
        children.push(new Paragraph({ children: [ new TextRun({ text: `OFICIO N¬∞ (${codigo}) ${anio}-MP-FN-2D-1FPCEDCF-LIMA.`, bold: true, underline: { type: UnderlineType.SINGLE }, size: 24, font: "Arial Narrow" }) ], spacing: { line: 276 } }));
        children.push(new Paragraph({ text: "" }));
        
        children.push(new Paragraph({ children: [ new TextRun({ text: "SE√ëORES:", bold: true, size: 24, font: "Arial Narrow" }) ], spacing: { line: 276 } }));
        children.push(new Paragraph({ children: [ new TextRun({ text: "UNIDAD DE PERITOS FECOF", bold: true, size: 24, font: "Arial Narrow" }) ], spacing: { line: 276 } }));
        children.push(new Paragraph({ children: [ new TextRun({ text: "Ministerio P√∫blico Fiscal√≠a de la Naci√≥n", bold: true, size: 24, font: "Arial Narrow" }) ], spacing: { line: 276 } }));
        children.push(new Paragraph({ children: [ new TextRun({ text: "PRESENTE.-", bold: true, underline: { type: UnderlineType.SINGLE }, size: 24, font: "Arial Narrow" }) ], spacing: { line: 276 } }));
        children.push(new Paragraph({ text: "" }));

        // ASUNTO
        children.push(new Paragraph({ indent: { left: 4000 }, children: [ new TextRun({ text: "ASUNTO: SOLICITUD DE DESIGNACI√ìN DE PERITOS", bold: true, underline: { type: UnderlineType.SINGLE }, size: 24, font: "Arial Narrow" }) ], spacing: { line: 276 } }));
        children.push(new Paragraph({ indent: { left: 4000 }, children: [ new TextRun({ text: `Referencia: Carpeta Fiscal N.¬∞ ${codigo}`, bold: true, size: 24, font: "Arial Narrow" }) ], spacing: { line: 276 } }));
        children.push(new Paragraph({ text: "" }));

        // CUERPO
        children.push(new Paragraph({
            indent: { firstLine: 720 },
            children: [
                new TextRun({ text: "Tengo a bien dirigirme a usted, en mi condici√≥n de Fiscal Provincial del Segundo Despacho de la Primera Fiscal√≠a Provincial Corporativa Especializada en Delitos de Corrupci√≥n de Funcionarios de Lima Centro, con el prop√≥sito de remitir adjunta a la presente comunicaci√≥n oficial, la disposici√≥n N.¬∞ ", size: 24, font: "Arial Narrow" }),
                new TextRun({ text: numDispo, bold: true, size: 24, font: "Arial Narrow" }),
                new TextRun({ text: " de fecha ", size: 24, font: "Arial Narrow" }),
                new TextRun({ text: fechaDispoTexto, bold: true, size: 24, font: "Arial Narrow" }),
                new TextRun({ text: ", reca√≠da en la carpeta fiscal de la referencia, en virtud del cual este despacho ha decidido ", size: 24, font: "Arial Narrow" }),
                new TextRun({ text: decision, bold: true, size: 24, font: "Arial Narrow" }),
                new TextRun({ text: ", en la investigaci√≥n seguida contra ", size: 24, font: "Arial Narrow" }),
                new TextRun({ text: imputados, bold: true, size: 24, font: "Arial Narrow" }),
                new TextRun({ text: " por la presunta comisi√≥n del delito contra la Administraci√≥n P√∫blica, en su modalidad de ", size: 24, font: "Arial Narrow" }),
                new TextRun({ text: delitoTexto, bold: true, size: 24, font: "Arial Narrow" }),
                new TextRun({ text: ", en agravio del Estado, fijando el t√©rmino de las actuaciones en ", size: 24, font: "Arial Narrow" }),
                new TextRun({ text: plazo, bold: true, size: 24, font: "Arial Narrow" }),
                new TextRun({ text: ".", size: 24, font: "Arial Narrow" })
            ],
            alignment: AlignmentType.JUSTIFIED,
            spacing: { line: 276 }
        }));
        children.push(new Paragraph({ text: "" }));

        // DATOS T√âCNICOS
        children.push(new Paragraph({ 
            children: [ new TextRun({ text: `Respecto de las pericias solicitadas en la Carpeta Fiscal ${codigo}`, underline: { type: UnderlineType.SINGLE }, size: 24, font: "Arial Narrow" }) ],
            indent: { left: 720 },
            alignment: AlignmentType.CENTER,
            spacing: { line: 276 }
        }));
        
        children.push(new Paragraph({ bullet: { level: 0 }, indent: { left: 1440 }, children: [ new TextRun({ text: "Etapa procesal: ", bold: true, size: 24, font: "Arial Narrow" }), new TextRun({ text: etapa, size: 24, font: "Arial Narrow" }) ], spacing: { line: 276 } }));
        children.push(new Paragraph({ bullet: { level: 0 }, indent: { left: 1440 }, children: [ new TextRun({ text: "Plazo de vencimiento: ", bold: true, size: 24, font: "Arial Narrow" }), new TextRun({ text: vencimientoTexto, size: 24, font: "Arial Narrow" }) ], spacing: { line: 276 } }));
        children.push(new Paragraph({ bullet: { level: 0 }, indent: { left: 1440 }, children: [ new TextRun({ text: "Cantidad de involucrados: ", bold: true, size: 24, font: "Arial Narrow" }), new TextRun({ text: involucrados, size: 24, font: "Arial Narrow" }) ], spacing: { line: 276 } }));
        children.push(new Paragraph({ bullet: { level: 0 }, indent: { left: 1440 }, children: [ new TextRun({ text: "Disposici√≥n que ordena las pericias: ", bold: true, size: 24, font: "Arial Narrow" }), new TextRun({ text: "Disposici√≥n N.¬∞ " + dispoOrdena, size: 24, font: "Arial Narrow" }) ], spacing: { line: 276 } }));
        children.push(new Paragraph({ text: "" }));

        // PERICIAS LOOP
        const cantPericias = document.getElementById('cantPericias').value;
        const cant = parseInt(cantPericias);
        
        for(let i=1; i<=cant; i++) {
            let tipo = document.getElementById(`tipoPericia_${i}`).value;
            let obj = document.getElementById(`objPericia_${i}`).value;
            let det = document.getElementById(`detPericia_${i}`).value;

            children.push(new Paragraph({ 
                children: [ new TextRun({ text: `${i}. RESPECTO DE LA PERICIA ${tipo.toUpperCase().replace('PERITO', '')}`, bold: true, size: 24, font: "Arial Narrow" }) ],
                indent: { left: 720 }, spacing: { line: 276 }
            }));
            
            children.push(new Paragraph({ indent: { left: 720 }, children: [ new TextRun({ text: `${i}.1. Objeto pericial`, bold: true, italics: true, size: 24, font: "Arial Narrow" }) ], spacing: { line: 276 } }));
            
            children.push(new Paragraph({ indent: { left: 1080 }, children: [ new TextRun({ text: obj, size: 24, font: "Arial Narrow" }) ], alignment: AlignmentType.JUSTIFIED, spacing: { line: 276 } }));
            if(det) {
                children.push(new Paragraph({ text: "" }));
                children.push(new Paragraph({ indent: { left: 1080 }, children: [ new TextRun({ text: det, size: 24, font: "Arial Narrow" }) ], alignment: AlignmentType.JUSTIFIED, spacing: { line: 276 } }));
            }
            children.push(new Paragraph({ text: "" }));
        }

        // EVIDENCIA
        const tieneEvidencia = document.getElementById('tieneEvidencia').value;
        if(tieneEvidencia === 'si') {
            const numEv = cant + 1;
            const desc = document.getElementById('descEvidencia').value;
            const link = document.getElementById('linkEvidencia').value;
            
            children.push(new Paragraph({ 
                children: [ new TextRun({ text: `${numEv}. INDICACI√ìN DE LA EVIDENCIA QUE SE ADJUNTA`, bold: true, size: 24, font: "Arial Narrow" }) ],
                indent: { left: 720 }, spacing: { line: 276 }
            }));
            
            children.push(new Paragraph({ indent: { left: 1080 }, children: [ new TextRun({ text: desc, size: 24, font: "Arial Narrow" }) ], alignment: AlignmentType.JUSTIFIED, spacing: { line: 276 } }));
            children.push(new Paragraph({ indent: { left: 1080 }, children: [ new TextRun({ text: link, color: "0000FF", underline: { type: UnderlineType.SINGLE }, size: 24, font: "Arial Narrow" }) ], alignment: AlignmentType.CENTER, spacing: { line: 276 } }));
            children.push(new Paragraph({ text: "" }));
        }

        // CIERRE
        children.push(new Paragraph({
            children: [ new TextRun({ text: "De manera que, tras la designaci√≥n del perito que se avocar√° a la realizaci√≥n del examen ordenado, este se deber√° poner en contacto con este despacho fiscal a trav√©s de los canales que se detallan, a fin de remitir la informaci√≥n necesaria y/o adicional para su elaboraci√≥n.", size: 24, font: "Arial Narrow" }) ],
            alignment: AlignmentType.JUSTIFIED, spacing: { line: 276 }
        }));
        // ESPACIO EXTRA ANTES DEL CORREO
        children.push(new Paragraph({ text: "" }));
        children.push(new Paragraph({ text: "" }));

        // TABLA CONTACTO
        const contactTable = new Table({
            width: { size: 90, type: WidthType.PERCENTAGE },
            indent: { size: 720, type: WidthType.DXA },
            rows: [
                new TableRow({ height: { value: 500, rule: HeightRule.AT_LEAST }, cantSplit: true, children: [ new TableCell({ children: [new Paragraph({children:[new TextRun({text: "CORREO ELECTR√ìNICO MESA DE PARTES", bold: true, size: 20, font: "Arial Narrow"})]})] }), new TableCell({ children: [new Paragraph({children:[new TextRun({text: emailMesa, size: 20, font: "Arial Narrow"})]})] }) ] }),
                new TableRow({ height: { value: 500, rule: HeightRule.AT_LEAST }, cantSplit: true, children: [ new TableCell({ children: [new Paragraph({children:[new TextRun({text: "CORREO ELECTR√ìNICO FISCAL ENCARGADO", bold: true, size: 20, font: "Arial Narrow"})]})] }), new TableCell({ children: [new Paragraph({children:[new TextRun({text: emailFiscal, size: 20, font: "Arial Narrow"})]})] }) ] }),
                new TableRow({ height: { value: 500, rule: HeightRule.AT_LEAST }, cantSplit: true, children: [ new TableCell({ children: [new Paragraph({children:[new TextRun({text: "TEL√âFONO FISCAL", bold: true, size: 20, font: "Arial Narrow"})]})] }), new TableCell({ children: [new Paragraph({children:[new TextRun({text: telFiscal, size: 20, font: "Arial Narrow"})]})] }) ] }),
                new TableRow({ height: { value: 500, rule: HeightRule.AT_LEAST }, cantSplit: true, children: [ new TableCell({ children: [new Paragraph({children:[new TextRun({text: "TEL√âFONO ASISTENTE", bold: true, size: 20, font: "Arial Narrow"})]})] }), new TableCell({ children: [new Paragraph({children:[new TextRun({text: telAsistente, size: 20, font: "Arial Narrow"})]})] }) ] })
            ]
        });
        children.push(contactTable);

        children.push(new Paragraph({ text: "" }));
        children.push(new Paragraph({ children: [ new TextRun({ text: "Sin otro particular que nos concierna, hago propicia la oportunidad para expresarle mi mayor consideraci√≥n y estima personal.", size: 24, font: "Arial Narrow" }) ], alignment: AlignmentType.JUSTIFIED, spacing: { line: 276 } }));
        children.push(new Paragraph({ text: "\n\n" }));
        children.push(new Paragraph({ children: [ new TextRun({ text: "Atentamente,", size: 24, font: "Arial Narrow" }) ], alignment: AlignmentType.CENTER }));

        const doc = new Document({
            sections: [{ 
                properties: { pageMargins: { top: 1417, right: 1701, bottom: 1417, left: 1701 } }, 
                children: children,
                footers: {
                    default: new Footer({
                        children: [
                            new Paragraph({ children: [ new TextRun({ text: "Tel√©fono: (01) 625-5555", size: 22, font: "Arial Narrow", color: "333333" }) ] }),
                            new Paragraph({ children: [ new TextRun({ text: "Anexos: 11706 / 11705", size: 22, font: "Arial Narrow", color: "333333" }) ] }),
                            new Paragraph({ children: [ new TextRun({ text: "E-mail: fecoflima_1f2d@mpfn.gob.pe", size: 22, font: "Arial Narrow", color: "333333" }) ] }),
                            new Paragraph({ children: [ new TextRun({ text: "Direcci√≥n: Jr. Lampa N.¬∞ 597 ‚Äì Cercado de Lima.", size: 22, font: "Arial Narrow", color: "333333" }) ] })
                        ]
                    })
                }
            }]
        });

        Packer.toBlob(doc).then(blob => { saveAs(blob, `Oficio_${codigo}.docx`); });
    }
</script>
</body>
</html>
