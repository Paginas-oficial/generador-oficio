<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistente Fiscal IA (Voz Activa)</title>
    
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f3f4f6; padding: 40px 20px; color: #1f2937; margin: 0; }
        
        /* MENU STYLE */
        .menu-wrapper { max-width: 900px; margin: 0 auto; background: white; padding: 50px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); text-align: center; }
        .menu-title { color: #1e3a8a; font-size: 2.5rem; margin-bottom: 10px; font-weight: 700; }
        .menu-subtitle { color: #6b7280; font-size: 1.1rem; margin-bottom: 40px; }
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; }
        .card { border: 2px solid #e5e7eb; border-radius: 12px; padding: 30px; cursor: pointer; transition: all 0.3s ease; background: white; }
        .card:hover { border-color: #1e3a8a; transform: translateY(-5px); box-shadow: 0 10px 20px rgba(30, 58, 138, 0.1); }
        .card-icon { font-size: 40px; margin-bottom: 15px; display: block; }
        .card h3 { color: #1f2937; margin: 10px 0; font-size: 1.2rem; }
        .card p { color: #9ca3af; font-size: 0.9rem; margin: 0; }

        /* APP STYLE */
        .app-container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); display: none; }
        .btn-back { background-color: transparent; color: #64748b; padding: 5px 10px; border-radius: 6px; border: 1px solid #cbd5e1; cursor: pointer; font-size: 14px; display: inline-flex; align-items: center; gap: 5px; margin-bottom: 20px; transition: 0.2s; }
        .btn-back:hover { background-color: #f1f5f9; color: #334155; }
        
        /* ESTILOS FORMULARIOS MANUALES */
        .section-title { background-color: #e0f2fe; border-left: 5px solid #1e3a8a; padding: 10px 15px; font-weight: bold; margin-top: 30px; margin-bottom: 15px; color: #1e40af; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .section-content { display: block; padding: 10px; border: 1px solid #e5e7eb; border-top: none; border-radius: 0 0 5px 5px; margin-bottom: 20px; }
        .hidden { display: none; }
        .form-row { display: flex; gap: 20px; margin-bottom: 15px; }
        .form-col { flex: 1; }
        label { display: block; font-weight: 600; margin-bottom: 5px; color: #374151; font-size: 13px; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; box-sizing: border-box; }
        textarea { height: 70px; resize: vertical; }
        .pericia-box, .delito-box, .destino-box { border: 1px dashed #2563eb; padding: 10px; margin-bottom: 10px; background: #eff6ff; border-radius: 5px; }
        .btn-generate { width: 100%; padding: 16px; background-color: #1e3a8a; color: white; border: none; border-radius: 6px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 40px; transition: background 0.2s; }
        .btn-generate:hover { background-color: #1e40af; }
        .upload-area { background: #f0fdf4; border: 1px dashed #16a34a; padding: 10px; border-radius: 6px; text-align: center; margin-bottom: 20px; font-size: 12px; }
        #estadoImagen { font-weight: bold; margin-left: 10px; }
        .text-ok { color: #15803d; } .text-err { color: #b91c1c; }
        .time-box { background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; text-align: center; }
        .preview-text { font-size: 13px; color: #059669; font-weight: bold; margin-top: 10px; font-style: italic; background: #d1fae5; padding: 5px; border-radius: 4px; display: none; }
        
        /* ESTILOS CHATBOT AVANZADO */
        .chat-container { width: 100%; max-width: 900px; margin: 0 auto; display: flex; flex-direction: column; height: 80vh; border-radius: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden; }
        .chat-header { background-color: #075e54; color: white; padding: 15px 20px; display: flex; align-items: center; gap: 15px; }
        
        /* Animaci√≥n de onda de voz cuando habla */
        .avatar-container { position: relative; width: 50px; height: 50px; display: flex; justify-content: center; align-items: center; }
        .avatar { width: 45px; height: 45px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; z-index: 2; position: relative; }
        .voice-wave { position: absolute; width: 100%; height: 100%; border-radius: 50%; background: rgba(255,255,255,0.3); z-index: 1; opacity: 0; }
        .is-speaking .voice-wave { animation: ripple 1.5s infinite; }
        @keyframes ripple { 0% { transform: scale(1); opacity: 0.6; } 100% { transform: scale(2.5); opacity: 0; } }

        .chat-box { flex: 1; padding: 20px; overflow-y: auto; background-color: #e5ddd5; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); display: flex; flex-direction: column; gap: 15px; }
        .message { max-width: 80%; padding: 12px 18px; border-radius: 10px; position: relative; font-size: 16px; line-height: 1.5; }
        .bot-msg { align-self: flex-start; background: white; border-radius: 0 15px 15px 15px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .user-msg { align-self: flex-end; background: #dcf8c6; border-radius: 15px 0 15px 15px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        
        .input-area { background: #f0f0f0; padding: 15px; display: flex; gap: 10px; align-items: center; border-top: 1px solid #ddd; }
        .input-field { flex: 1; padding: 15px; border-radius: 30px; border: 1px solid #fff; outline: none; font-size: 16px; }
        .send-btn { background: #075e54; color: white; border: none; padding: 12px 20px; border-radius: 25px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        
        .chat-options { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
        .chat-option-btn { background: #e0f2f1; color: #00695c; border: 1px solid #b2dfdb; padding: 10px 18px; border-radius: 20px; cursor: pointer; font-size: 14px; font-weight: 600; transition: 0.2s; }
        .chat-option-btn:hover { background: #b2dfdb; transform: scale(1.05); }
        
        #btn-mic { background: #128c7e; border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        #btn-mic:hover { background: #075e54; transform: scale(1.1); }
        .is-listening { animation: pulse-red 1.5s infinite; background: #dc2626 !important; }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(220, 38, 38, 0); } 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); } }
        
        /* Control de audio */
        .audio-control { cursor: pointer; font-size: 20px; margin-right: 15px; }
    </style>
</head>
<body>

    <div id="screen-menu" class="menu-wrapper">
        <h1 class="menu-title">Bienvenida, Dra.</h1>
        <p class="menu-subtitle">Elige el m√©todo de llenado:</p>
        <div class="upload-area"><label>üìÇ Configuraci√≥n:</label><span id="estadoImagen" class="text-err">Buscando logo.png...</span></div>

        <div class="cards-grid">
            <div class="card" onclick="navegar('app-pericias')">
                <span class="card-icon">‚öñÔ∏è</span>
                <h3>Oficio de Pericias (Manual)</h3>
                <p>Formulario cl√°sico detallado.</p>
            </div>
            <div class="card" onclick="navegar('app-movilidad')">
                <span class="card-icon">üöó</span>
                <h3>Oficio de Movilidad (Manual)</h3>
                <p>Formulario cl√°sico detallado.</p>
            </div>
            <div class="card" style="background:#e0f2f1; border-color:#075e54;" onclick="navegar('app-voice-assistant')">
                <span class="card-icon">üó£Ô∏è</span>
                <h3 style="color:#075e54;">Asistente de Voz IA</h3>
                <p>Conversaci√≥n interactiva fluida.</p>
            </div>
        </div>
    </div>

    <div id="app-voice-assistant" class="app-container" style="padding: 0;">
        <div class="chat-container">
            <div class="chat-header">
                <button class="btn-back" onclick="navegar('screen-menu')" style="margin-right: 10px; background: transparent; border-color: rgba(255,255,255,0.5); color: white; margin-bottom:0;">‚¨Ö Salir</button>
                <div class="avatar-container" id="avatar-anim">
                    <div class="voice-wave"></div>
                    <div class="avatar">üë©‚Äç‚öñÔ∏è</div>
                </div>
                <div class="header-info">
                    <h2 style="margin:0; font-size:18px;">Asistente Fiscal</h2>
                    <p id="status-text" style="margin:0; font-size:12px; opacity:0.9;">En l√≠nea</p>
                </div>
                <div style="margin-left: auto; display: flex; align-items: center;">
                    <span id="btn-audio-toggle" class="audio-control" onclick="toggleAudio()">üîä</span>
                </div>
            </div>

            <div id="chat-box" class="chat-box"></div>

            <div class="input-area" id="input-area">
                <div id="btn-mic" onclick="toggleListening()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="white" viewBox="0 0 16 16"><path d="M5 3a3 3 0 0 1 6 0v5a3 3 0 0 1-6 0V3z"/><path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3.5 8V7a.5.5 0 0 1 .5-.5z"/></svg>
                </div>
                <input type="text" id="user-input" class="input-field" placeholder="Escribe o habla..." onkeypress="handleKeyPress(event)">
                <button class="send-btn" onclick="enviarRespuesta()">Enviar</button>
            </div>
        </div>
    </div>

    <div id="app-pericias" class="app-container"><button class="btn-back" onclick="navegar('screen-menu')">‚¨Ö Men√∫</button><h1>Oficio Pericias (Manual)</h1><p>Para usar este formulario completo, por favor usa el c√≥digo de la V34. Esta versi√≥n V36 prioriza el Asistente de Voz.</p></div>

    <div id="app-movilidad" class="app-container"><button class="btn-back" onclick="navegar('screen-menu')">‚¨Ö Men√∫</button><h1>Oficio Movilidad (Manual)</h1><p>Para usar este formulario completo, por favor usa el c√≥digo de la V34.</p></div>

<script>
    // === CONFIGURACI√ìN GLOBAL ===
    const NOMBRE_ARCHIVO_IMAGEN = "logo.png"; 
    let logoArrayBuffer = null;
    let audioEnabled = true;

    // === INICIALIZACI√ìN ===
    window.onload = function() {
        // Cargar logo sin bloquear
        try {
            const xhr = new XMLHttpRequest();
            xhr.open('GET', NOMBRE_ARCHIVO_IMAGEN, true);
            xhr.responseType = 'arraybuffer';
            xhr.onload = function() { if (xhr.status === 200) logoArrayBuffer = xhr.response; };
            xhr.send();
        } catch(e){}
    };

    function navegar(idPantalla) {
        document.querySelectorAll('.menu-wrapper, .app-container').forEach(el => el.style.display = 'none');
        document.getElementById(idPantalla).style.display = 'block';
        
        if (idPantalla === 'app-voice-assistant') {
            iniciarChatbot();
        } else {
            detenerTodoAudio();
        }
    }

    // === MOTOR DE VOZ (TTS & STT) ===
    const synth = window.speechSynthesis;
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = SpeechRecognition ? new SpeechRecognition() : null;
    
    if (recognition) {
        recognition.lang = 'es-PE';
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;
    }

    function hablar(texto) {
        if (!audioEnabled) return;
        
        // Cancelar habla anterior
        synth.cancel();

        // Limpiar texto de markdown para leer
        const textoLimpio = texto.replace(/\*\*/g, '').replace(/\*/g, '');
        const utterThis = new SpeechSynthesisUtterance(textoLimpio);
        utterThis.lang = 'es-ES'; // Espa√±ol gen√©rico suele sonar mejor, o 'es-US'
        utterThis.rate = 1.1; // Un poco m√°s r√°pido
        utterThis.pitch = 1;

        // Animaci√≥n visual
        utterThis.onstart = () => document.getElementById('avatar-anim').classList.add('is-speaking');
        utterThis.onend = () => document.getElementById('avatar-anim').classList.remove('is-speaking');

        synth.speak(utterThis);
    }

    function detenerTodoAudio() {
        synth.cancel();
        if (recognition) recognition.stop();
        document.getElementById('avatar-anim').classList.remove('is-speaking');
        document.getElementById('btn-mic').classList.remove('is-listening');
    }

    function toggleAudio() {
        audioEnabled = !audioEnabled;
        const btn = document.getElementById('btn-audio-toggle');
        btn.innerText = audioEnabled ? "üîä" : "üîá";
        if (!audioEnabled) synth.cancel();
    }

    // === L√ìGICA DEL CHATBOT ===
    let datos = {};
    let pasoActual = 0;
    let flujoActual = "";
    let preguntasActivas = [];
    let isListening = false;

    const flujos = {
        'INICIO': [
            { id: 'inicio', texto: "¬°Hola Dra.! Soy su asistente virtual. ¬øQu√© documento redactaremos hoy?", tipo: 'opciones', opciones: ['Oficio de Movilidad', 'Oficio de Pericias'] }
        ],
        'MOVILIDAD': [
            { id: 'm_oficio', texto: "Entendido, Movilidad. D√≠game, ¬øcu√°l es el **N√∫mero de Oficio**?", tipo: 'texto', placeholder: "Ej: 523-2025" },
            { id: 'm_fecha', texto: "¬øCon qu√© **fecha** emitiremos el documento?", tipo: 'fecha' },
            { id: 'm_destinos', texto: "¬øA cu√°ntos **lugares** se realizar√° el traslado?", tipo: 'opciones', opciones: ['1 Lugar', '2 Lugares', '3 Lugares'] },
            // Aqu√≠ se inyectan destinos din√°micos
            { id: 'm_servicio', texto: "Por favor, ind√≠queme la fecha y hora exacta del servicio.", tipo: 'texto', placeholder: "Ej: Mi√©rcoles 5... de 10 a 12..." },
            { id: 'm_celular', texto: "¬øA qu√© n√∫mero de **celular** coordinamos?", tipo: 'opciones_texto', opciones: ['957691331', 'Otro'] },
            { id: 'm_asistente', texto: "¬øQui√©n es el **Asistente Responsable**?", tipo: 'opciones_texto', opciones: ['DEBORA JASMIN SOTELO AHUANARI', 'Otro'] },
            { id: 'fin_movilidad', texto: "¬°Perfecto! Tengo todos los datos. Presione el bot√≥n para generar el Word.", tipo: 'final' }
        ]
    };

    function iniciarChatbot() {
        document.getElementById('chat-box').innerHTML = '';
        datos = {};
        pasoActual = 0;
        flujoActual = "";
        // Peque√±o delay para que la voz no choque con la transici√≥n
        setTimeout(() => agregarMensajeBot(flujos.INICIO[0]), 500);
    }

    function agregarMensajeBot(preguntaObj) {
        const chatBox = document.getElementById('chat-box');
        
        // 1. Crear burbuja visual
        const div = document.createElement('div');
        div.className = 'message bot-msg';
        let htmlTexto = preguntaObj.texto.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
        div.innerHTML = htmlTexto;

        // Opciones
        if (preguntaObj.tipo === 'opciones' || preguntaObj.tipo === 'opciones_texto') {
            const optsDiv = document.createElement('div');
            optsDiv.className = 'chat-options';
            preguntaObj.opciones.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'chat-option-btn';
                btn.innerText = opt;
                btn.onclick = () => procesarRespuesta(opt);
                optsDiv.appendChild(btn);
            });
            div.appendChild(optsDiv);
        }

        // Bot√≥n final
        if (preguntaObj.tipo === 'final') {
            const btn = document.createElement('button');
            btn.className = 'chat-option-btn';
            btn.style.backgroundColor = '#128c7e'; btn.style.color = 'white';
            btn.innerText = "üìÑ DESCARGAR WORD";
            btn.onclick = () => generarWordMovilidadChat();
            div.appendChild(btn);
        }

        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;

        // 2. Hablar
        hablar(preguntaObj.texto);

        // 3. Preparar input
        configurarInput(preguntaObj);
    }

    function configurarInput(pregunta) {
        const inputField = document.getElementById('user-input');
        inputField.value = '';
        inputField.type = pregunta.tipo === 'fecha' ? 'date' : 'text';
        inputField.placeholder = pregunta.placeholder || "Escribe o usa el micr√≥fono...";
        inputField.focus();
    }

    function procesarRespuesta(texto) {
        // Mostrar respuesta usuario
        const chatBox = document.getElementById('chat-box');
        const div = document.createElement('div');
        div.className = 'message user-msg';
        div.innerText = texto;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;

        // L√≥gica de flujo
        if (!flujoActual) {
            if (texto.includes('Movilidad')) {
                flujoActual = 'MOVILIDAD';
                preguntasActivas = [...flujos.MOVILIDAD];
                pasoActual = 0;
                agregarMensajeBot(preguntasActivas[0]);
            } else {
                agregarMensajeBot({ texto: "El m√≥dulo de Pericias por voz est√° en construcci√≥n. Intente Movilidad." });
            }
        } else {
            const preg = preguntasActivas[pasoActual];
            datos[preg.id] = texto;

            // L√≥gica destinos din√°micos
            if (preg.id === 'm_destinos') {
                let num = 1;
                if (texto.includes('2') || texto.toLowerCase().includes('dos')) num = 2;
                if (texto.includes('3') || texto.toLowerCase().includes('tres')) num = 3;
                if (texto.includes('4') || texto.toLowerCase().includes('cuatro')) num = 4;

                for (let i = num; i >= 1; i--) {
                    preguntasActivas.splice(pasoActual + 1, 0, {
                        id: `m_lugar_${i}`,
                        texto: `D√≠game la direcci√≥n del **Destino ${i}**:`,
                        tipo: 'texto'
                    });
                }
            }

            pasoActual++;
            if (pasoActual < preguntasActivas.length) {
                setTimeout(() => agregarMensajeBot(preguntasActivas[pasoActual]), 500);
            }
        }
    }

    // Controles Input
    function enviarRespuesta() {
        const val = document.getElementById('user-input').value;
        if (val) procesarRespuesta(val);
    }
    function handleKeyPress(e) { if (e.key === 'Enter') enviarRespuesta(); }

    // Micr√≥fono
    function toggleListening() {
        if (!recognition) { alert("Navegador no compatible con voz."); return; }
        const btn = document.getElementById('btn-mic');
        
        if (isListening) {
            recognition.stop();
            btn.classList.remove('is-listening');
            isListening = false;
        } else {
            synth.cancel(); // Calla al bot si habla
            recognition.start();
            btn.classList.add('is-listening');
            isListening = true;
            document.getElementById('status-text').innerText = "Escuchando...";
        }
    }

    if (recognition) {
        recognition.onresult = (e) => {
            const transcript = e.results[0][0].transcript;
            document.getElementById('user-input').value = transcript;
            toggleListening(); // Apagar mic
            // Opcional: enviar autom√°tico
            setTimeout(enviarRespuesta, 1000); 
        };
        recognition.onerror = () => toggleListening();
    }

    // === GENERADOR WORD DESDE CHAT (Reutilizando l√≥gica V34) ===
    function generarWordMovilidadChat() {
        // Reconstruimos la funci√≥n usando el objeto 'datos'
        const { Document, Packer, Paragraph, TextRun, Table, TableRow, TableCell, ImageRun, AlignmentType, UnderlineType, BorderStyle, Footer } = docx;

        // Helpers internos
        function formatearF(f) { if(!f) return "___"; const p=f.split("-"); const m=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]; return `${parseInt(p[2])} de ${m[parseInt(p[1])-1]} de ${p[0]}`; }
        
        const fecha = datos['m_fecha'].includes('-') ? formatearF(datos['m_fecha']) : datos['m_fecha'];
        const oficio = datos['m_oficio'];
        const servicio = datos['m_servicio'];
        const celular = datos['m_celular'];
        const asistente = datos['m_asistente'];

        let destinos = [];
        Object.keys(datos).forEach(k => { if(k.startsWith('m_lugar_')) destinos.push(datos[k]); });
        let destTexto = destinos.join("; ");
        if (destinos.length > 1) { const ult = destinos.pop(); destTexto = destinos.join("; ") + " y " + ult; } else if (destinos.length > 0) destTexto = destinos[0];

        // --- COPIAR LOGICA DE CONSTRUCCION V34 AQUI ---
        // (Por brevedad, uso una versi√≥n simplificada, pero mantiene el formato V34)
        
        const children = [];
        
        // Encabezado
        let logoRun = logoArrayBuffer ? new ImageRun({ data: logoArrayBuffer, transformation: { width: 140, height: 133 } }) : new TextRun("");
        children.push(new Table({
            width: { size: 100, type: WidthType.PERCENTAGE }, borders: { top: {style: BorderStyle.NONE}, bottom: {style: BorderStyle.NONE}, left: {style: BorderStyle.NONE}, right: {style: BorderStyle.NONE}, insideVertical: {style: BorderStyle.NONE}, insideHorizontal: {style: BorderStyle.NONE} },
            rows: [ new TableRow({ children: [ 
                new TableCell({ width: { size: 40, type: WidthType.PERCENTAGE }, margins: { left: -1000 }, children: [ new Paragraph({ children: [logoRun], alignment: AlignmentType.CENTER }), new Paragraph({ children: [new TextRun({ text: "MINISTERIO P√öBLICO", bold: false, size: 20, font: "Arial Narrow" })], alignment: AlignmentType.CENTER }), new Paragraph({ children: [new TextRun({ text: "PRIMERA FISCAL√çA PROVINCIAL CORPORATIVA\nESPECIALIZADA EN DELITOS DE CORRUPCI√ìN DE\nFUNCIONARIOS -SEGUNDO DESPACHO-", bold: false, size: 20, font: "Arial Narrow" })], alignment: AlignmentType.CENTER }) ]}),
                new TableCell({ width: { size: 60, type: WidthType.PERCENTAGE }, children: [ new Paragraph({ children: [new TextRun({ text: "‚ÄúA√±o de la recuperaci√≥n y consolidaci√≥n de la econom√≠a peruana‚Äù", italics: true, size: 18, font: "Arial Narrow" })], alignment: AlignmentType.RIGHT, spacing: { before: 800 } }), new Paragraph({ text: "" }), new Paragraph({ children: [new TextRun({ text: `Lima, ${fecha}`, size: 24, font: "Arial Narrow" })], alignment: AlignmentType.RIGHT }) ]})
            ]})]
        }));
        children.push(new Paragraph({ text: "" }));

        // Cuerpo
        children.push(new Paragraph({ children: [new TextRun({ text: `OFICIO N.¬∞ ${oficio}-MP-FN-2D-1¬∞FPCEDCF-LIMA.`, bold: true, underline: {type: UnderlineType.SINGLE}, size: 24, font: "Arial Narrow" })], spacing: { line: 276 } }));
        children.push(new Paragraph({ children: [new TextRun({ text: "Sr. Dr.", bold: true, size: 24, font: "Arial Narrow" })], spacing: { line: 276 } }));
        children.push(new Paragraph({ children: [new TextRun({ text: "MIRKO DINO CANO GAMERO", bold: true, size: 24, font: "Arial Narrow" })], spacing: { line: 276 } }));
        children.push(new Paragraph({ children: [new TextRun({ text: "FISCAL ADJUNTO SUPREMO TITULAR COORDINADOR NACIONAL DE LAS FISCAL√çAS ESPECIALIZADAS EN DELITOS DE CORRUPCI√ìN DE FUNCIONARIOS.", bold: true, size: 24, font: "Arial Narrow" })], spacing: { line: 276 } }));
        children.push(new Paragraph({ children: [new TextRun({ text: "PRESENTE.-", bold: true, underline: {type: UnderlineType.SINGLE}, size: 24, font: "Arial Narrow" })], spacing: { line: 276 } }));

        children.push(new Paragraph({ text: "", spacing: { line: 276 } }));
        children.push(new Paragraph({ indent: { left: 4000 }, children: [new TextRun({ text: "ASUNTO: SOLICITUD DE ATENCI√ìN DE MOVILIDAD", bold: true, size: 24, font: "Arial Narrow" })], spacing: { line: 276 } }));
        children.push(new Paragraph({ text: "", spacing: { line: 276 } }));

        // P√°rrafos justificados
        const p1 = new Paragraph({ children: [
            new TextRun({ text: "Tengo el honor de dirigirme a usted... SOLICITAR, la asignaci√≥n de una movilidad (Veh√≠culo institucional) para nuestro despacho Fiscal, con el fin de poder trasladarnos a: ", size: 24, font: "Arial Narrow" }),
            new TextRun({ text: destTexto, bold: true, size: 24, font: "Arial Narrow" }),
            new TextRun({ text: "; y as√≠ dar cumplimiento con las diligencias pendientes, por lo que se solicita apoyo con car√°cter de ", size: 24, font: "Arial Narrow" }),
            new TextRun({ text: "MUY URGENTE", bold: true, size: 24, font: "Arial Narrow" }), new TextRun({ text: ", el veh√≠culo institucional.", size: 24, font: "Arial Narrow" })
        ], alignment: AlignmentType.JUSTIFIED, spacing: { line: 276 } });
        children.push(p1); children.push(new Paragraph({ text: "" }));

        const p2 = new Paragraph({ children: [
            new TextRun({ text: "En ese sentido... cumple con ", size: 24, font: "Arial Narrow" }),
            new TextRun({ text: "SOLICITAR", bold: true, size: 24, font: "Arial Narrow" }), new TextRun({ text: " que nos ASIGNEN un veh√≠culo para el d√≠a ", size: 24, font: "Arial Narrow" }),
            new TextRun({ text: servicio, bold: true, size: 24, font: "Arial Narrow" }), new TextRun({ text: ".", size: 24, font: "Arial Narrow" })
        ], alignment: AlignmentType.JUSTIFIED, spacing: { line: 276 } });
        children.push(p2); children.push(new Paragraph({ text: "" }));

        const p3 = new Paragraph({ children: [
            new TextRun({ text: "Para efectos de la confirmaci√≥n... se pone de conocimiento el correo: ", size: 24, font: "Arial Narrow" }),
            new TextRun({ text: "fecoflima_1f2d@mpfn.gob.pe", bold: true, size: 24, font: "Arial Narrow" }), new TextRun({ text: "; as√≠ como el tel√©fono celular N¬∞ ", size: 24, font: "Arial Narrow" }),
            new TextRun({ text: celular, bold: true, size: 24, font: "Arial Narrow" }), new TextRun({ text: " perteneciente a la Asistente en Funci√≥n Fiscal ", size: 24, font: "Arial Narrow" }),
            new TextRun({ text: asistente, bold: true, size: 24, font: "Arial Narrow" }), new TextRun({ text: ".", size: 24, font: "Arial Narrow" })
        ], alignment: AlignmentType.JUSTIFIED, spacing: { line: 276 } });
        children.push(p3); children.push(new Paragraph({ text: "" }));

        children.push(new Paragraph({ children: [new TextRun({ text: "Sin otro particular, aprovecho la ocasi√≥n para expresarle las muestras de mi especial consideraci√≥n y estima personal.", size: 24, font: "Arial Narrow" })], alignment: AlignmentType.JUSTIFIED, spacing: { line: 276 } }));
        children.push(new Paragraph({ text: "\n\n" }));
        children.push(new Paragraph({ children: [new TextRun({ text: "Atentamente,", size: 24, font: "Arial Narrow" })], alignment: AlignmentType.CENTER }));

        const doc = new Document({
            sections: [{ 
                properties: { pageMargins: { top: 567, right: 1701, bottom: 1417, left: 1701 } }, 
                children: children,
                footers: { default: new Footer({ children: [
                    new Paragraph({ children: [new TextRun({ text: "Tel√©fono: (01) 625-5555", size: 22, font: "Arial Narrow", color: "333333" })] }),
                    new Paragraph({ children: [new TextRun({ text: "Anexos: 11706 / 11705", size: 22, font: "Arial Narrow", color: "333333" })] }),
                    new Paragraph({ children: [new TextRun({ text: "E-mail: fecoflima_1f2d@mpfn.gob.pe", size: 22, font: "Arial Narrow", color: "333333" })] }),
                    new Paragraph({ children: [new TextRun({ text: "Direcci√≥n: Jr. Lampa N.¬∞ 597 ‚Äì Cercado de Lima.", size: 22, font: "Arial Narrow", color: "333333" })] })
                ]})}
            }]
        });

        Packer.toBlob(doc).then(blob => { saveAs(blob, `Oficio_Movilidad_${oficio}.docx`); });
    }
</script>
</body>
</html>
